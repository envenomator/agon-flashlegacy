Zilog eZ80 Macro Assembler Version 4.3 (19073001) RELISTED02-Nov-23     12:23:06     page:   1


PC     Object              I  Line    Source 
                           A     1    ;
                           A     2    ; Title:	crc32
                           A     3    ; Author:	Leigh Brown
                           A     4    ; Created:	26/05/2023
                           A     5    ; Last Updated:	14/10/2023
                           A     6    
                           A     7    ; Modinfo
                           A     8    ;	crc32 can handle different blocks now
                           A     9    
                           A    10    	XDEF	_crc32
                           A    11    	XDEF	_crc32_initialize
                           A    12    	XDEF	_crc32_finalize
                           A    13    
                           A    14    	.ASSUME ADL = 1
                           A    15    	SEGMENT		CODE
                           A    16    
                           A    17    ; UINT32 crc32(const char *s, UINT24 len);
                           A    18    ;              IX+6           IX+9
                           A    19    ; NB: We use local stack storage without alloca
                           A    20    ;     That's okay, /as long as/ we don't call a
                           A    21    
                           A    22    	SCOPE
                           A    23    
041588                     A    24    _crc32_initialize:
                           A    25        ; Initialise output to 0xFFFFFFFF
041588 D9                  A    26        EXX
041589 3EFF                A    27        LD  A, FFh
04158B 32 03 28 04         A    28        LD  (crc32result+3), A
04158F 32 02 28 04         A    29        LD  (crc32result+2), A
041593 32 01 28 04         A    30        LD  (crc32result+1), A
041597 32 00 28 04         A    31        LD  (crc32result), A
04159B D9                  A    32        EXX
04159C C9                  A    33        RET
                           A    34    
04159D                     A    35    _crc32_finalize:
04159D DDE5                A    36    	PUSH	IX
04159F DD210000 00         A    37    	LD		IX,0
0415A4 DD39                A    38    	ADD		IX,SP
                           A    39    
0415A6 3A 03 28 04         A    40        LD  A, (crc32result+3)
0415AA 2F                  A    41        CPL
0415AB 32 03 28 04         A    42        LD  (crc32result+3), A
0415AF 3A 02 28 04         A    43        LD  A, (crc32result+2)
0415B3 2F                  A    44        CPL
0415B4 32 02 28 04         A    45        LD  (crc32result+2), A
0415B8 3A 01 28 04         A    46        LD  A, (crc32result+1)
0415BC 2F                  A    47        CPL
0415BD 32 01 28 04         A    48        LD  (crc32result+1), A
0415C1 3A 00 28 04         A    49        LD  A, (crc32result)
0415C5 2F                  A    50        CPL
0415C6 32 00 28 04         A    51        LD  (crc32result), A
                           A    52    
0415CA 3A 03 28 04         A    53    	LD	A, (crc32result+3)
0415CE 11000000            A    54    	LD	DE, 0
0415D2 5F                  A    55    	LD	E, A
0415D3 2A 00 28 04         A    56    	LD	HL, (crc32result)
0415D7 DDE1                A    57    	POP	IX
0415D9 C9                  A    58    	RET
                           A    59    
0415DA                     A    60    _crc32:
                           A    61    	; Function prologue
0415DA DDE5                A    62    	PUSH	IX
0415DC DD210000 00         A    63    	LD		IX,0
0415E1 DD39                A    64    	ADD		IX,SP
                           A    65    
0415E3 DD1706              A    66    	LD		DE, (IX+6)
0415E6 DD2709              A    67    	LD		HL, (IX+9)
                           A    68    ; expects DE to point to buffer to check
                           A    69    ; expects HL to contain the bytecount
0415E9 01010000            A    70        LD		BC,1
                           A    71    
0415ED D9                  A    72        EXX
0415EE 3A 03 28 04         A    73        LD A, (crc32result+3)
0415F2 57                  A    74        LD D, A
0415F3 3A 02 28 04         A    75        LD A, (crc32result+2)
0415F7 5F                  A    76        LD E, A
0415F8 3A 01 28 04         A    77        LD A, (crc32result+1)
0415FC 47                  A    78        LD B, A
0415FD 3A 00 28 04         A    79        LD A, (crc32result)
041601 4F                  A    80        LD C, A
041602 D9                  A    81        EXX
                           A    82    
041603                     A    83    $$:	
041603 1A                  A    84        LD	A,(DE)
041604 13                  A    85        INC	DE
                           A    86        
                           A    87        ; Calculate offset into lookup table
041605 D9                  A    88        EXX
041606 A9                  A    89        XOR	C
041607 21 00 09 01         A    90        LD	HL,crc32_lookup_table >> 2
04160B 6F                  A    91        LD	L,A
04160C 29                  A    92        ADD	HL,HL
04160D 29                  A    93        ADD	HL,HL
                           A    94    
04160E 78                  A    95        LD	A,B
04160F AE                  A    96        XOR	(HL)
041610 23                  A    97        INC	HL
041611 4F                  A    98        LD	C,A
                           A    99    
041612 7B                  A   100        LD	A,E
041613 AE                  A   101        XOR	(HL)
041614 23                  A   102        INC	HL
041615 47                  A   103        LD	B,A
                           A   104    
041616 7A                  A   105        LD	A,D
041617 AE                  A   106        XOR	(HL)
041618 23                  A   107        INC	HL
041619 5F                  A   108        LD	E,A
                           A   109    
04161A 56                  A   110        LD	D,(HL)
04161B D9                  A   111        EXX
                           A   112    
                           A   113        ; Decrement count and loop if not zero
04161C B7                  A   114        OR	A,A
04161D ED42                A   115        SBC	HL,BC
04161F 20 E2               A   116        JR	NZ,$B
                           A   117    
041621 D9                  A   118        EXX
041622 7A                  A   119        LD  A, D
041623 32 03 28 04         A   120        LD  (crc32result+3), A
041627 7B                  A   121        LD  A, E
041628 32 02 28 04         A   122        LD  (crc32result+2), A
04162C 78                  A   123        LD  A, B
04162D 32 01 28 04         A   124        LD  (crc32result+1), A
041631 79                  A   125        LD  A, C
041632 32 00 28 04         A   126        LD  (crc32result), A
041636 D9                  A   127        EXX
                           A   128    
                           A   129    	; Function epilogue
041637 DDE1                A   130    	POP	IX
041639 C9                  A   131    	RET
                           A   132    
                           A   133    		SEGMENT	DATA
                           A   134    
                           A   135    		; The crc32 routine is optimised in suc
                           A   136    		; the following table to be aligned on 
                           A   137    
                           A   138    		ALIGN	1024
042400                     A   139    crc32_lookup_table:
042400 00000000 96300777   A   140    		DL	%00000000, %77073096, %ee0e612c, %9
042408 2C610EEE BA510999 
042410 19C46D07 8FF46A70   A   141    		DL	%076dc419, %706af48f, %e963a535, %9
042418 35A563E9 A395649E 
042420 3288DB0E A4B8DC79   A   142    		DL	%0edb8832, %79dcb8a4, %e0d5e91e, %9
042428 1EE9D5E0 88D9D297 
042430 2B4CB609 BD7CB17E   A   143    		DL	%09b64c2b, %7eb17cbd, %e7b82d07, %9
042438 072DB8E7 911DBF90 
042440 6410B71D F220B06A   A   144    		DL	%1db71064, %6ab020f2, %f3b97148, %8
042448 4871B9F3 DE41BE84 
042450 7DD4DA1A EBE4DD6D   A   145    		DL	%1adad47d, %6ddde4eb, %f4d4b551, %8
042458 51B5D4F4 C785D383 
042460 56986C13 C0A86B64   A   146    		DL	%136c9856, %646ba8c0, %fd62f97a, %8
042468 7AF962FD ECC9658A 
042470 4F5C0114 D96C0663   A   147    		DL	%14015c4f, %63066cd9, %fa0f3d63, %8
042478 633D0FFA F50D088D 
042480 C8206E3B 5E10694C   A   148    		DL	%3b6e20c8, %4c69105e, %d56041e4, %a
042488 E44160D5 727167A2 
042490 D1E4033C 47D4044B   A   149    		DL	%3c03e4d1, %4b04d447, %d20d85fd, %a
042498 FD850DD2 6BB50AA5 
0424A0 FAA8B535 6C98B242   A   150    		DL	%35b5a8fa, %42b2986c, %dbbbc9d6, %a
0424A8 D6C9BBDB 40F9BCAC 
0424B0 E36CD832 755CDF45   A   151    		DL	%32d86ce3, %45df5c75, %dcd60dcf, %a
0424B8 CF0DD6DC 593DD1AB 
0424C0 AC30D926 3A00DE51   A   152    		DL	%26d930ac, %51de003a, %c8d75180, %b
0424C8 8051D7C8 1661D0BF 
0424D0 B5F4B421 23C4B356   A   153    		DL	%21b4f4b5, %56b3c423, %cfba9599, %b
0424D8 9995BACF 0FA5BDB8 
0424E0 9EB80228 0888055F   A   154    		DL	%2802b89e, %5f058808, %c60cd9b2, %b
0424E8 B2D90CC6 24E90BB1 
0424F0 877C6F2F 114C6858   A   155    		DL	%2f6f7c87, %58684c11, %c1611dab, %b
0424F8 AB1D61C1 3D2D66B6 
042500 9041DC76 0671DB01   A   156    		DL	%76dc4190, %01db7106, %98d220bc, %e
042508 BC20D298 2A10D5EF 
042510 8985B171 1FB5B606   A   157    		DL	%71b18589, %06b6b51f, %9fbfe4a5, %e
042518 A5E4BF9F 33D4B8E8 
042520 A2C90778 34F9000F   A   158    		DL	%7807c9a2, %0f00f934, %9609a88e, %e
042528 8EA80996 18980EE1 
042530 BB0D6A7F 2D3D6D08   A   159    		DL	%7f6a0dbb, %086d3d2d, %91646c97, %e
042538 976C6491 015C63E6 
042540 F4516B6B 62616C1C   A   160    		DL	%6b6b51f4, %1c6c6162, %856530d8, %f
042548 D8306585 4E0062F2 
042550 ED95066C 7BA5011B   A   161    		DL	%6c0695ed, %1b01a57b, %8208f4c1, %f
042558 C1F40882 57C40FF5 
042560 C6D9B065 50E9B712   A   162    		DL	%65b0d9c6, %12b7e950, %8bbeb8ea, %f
042568 EAB8BE8B 7C88B9FC 
042570 DF1DDD62 492DDA15   A   163    		DL	%62dd1ddf, %15da2d49, %8cd37cf3, %f
042578 F37CD38C 654CD4FB 
042580 5861B24D CE51B53A   A   164    		DL	%4db26158, %3ab551ce, %a3bc0074, %d
042588 7400BCA3 E230BBD4 
042590 41A5DF4A D795D83D   A   165    		DL	%4adfa541, %3dd895d7, %a4d1c46d, %d
042598 6DC4D1A4 FBF4D6D3 
0425A0 6AE96943 FCD96E34   A   166    		DL	%4369e96a, %346ed9fc, %ad678846, %d
0425A8 468867AD D0B860DA 
0425B0 732D0444 E51D0333   A   167    		DL	%44042d73, %33031de5, %aa0a4c5f, %d
0425B8 5F4C0AAA C97C0DDD 
0425C0 3C710550 AA410227   A   168    		DL	%5005713c, %270241aa, %be0b1010, %c
0425C8 10100BBE 86200CC9 
0425D0 25B56857 B3856F20   A   169    		DL	%5768b525, %206f85b3, %b966d409, %c
0425D8 09D466B9 9FE461CE 
0425E0 0EF9DE5E 98C9D929   A   170    		DL	%5edef90e, %29d9c998, %b0d09822, %c
0425E8 2298D0B0 B4A8D7C7 
0425F0 173DB359 810DB42E   A   171    		DL	%59b33d17, %2eb40d81, %b7bd5c3b, %c
0425F8 3B5CBDB7 AD6CBAC0 
042600 2083B8ED B6B3BF9A   A   172    		DL	%edb88320, %9abfb3b6, %03b6e20c, %7
042608 0CE2B603 9AD2B174 
042610 3947D5EA AF77D29D   A   173    		DL	%ead54739, %9dd277af, %04db2615, %7
042618 1526DB04 8316DC73 
042620 120B63E3 843B6494   A   174    		DL	%e3630b12, %94643b84, %0d6d6a3e, %7
042628 3E6A6D0D A85A6A7A 
042630 0BCF0EE4 9DFF0993   A   175    		DL	%e40ecf0b, %9309ff9d, %0a00ae27, %7
042638 27AE000A B19E077D 
042640 44930FF0 D2A30887   A   176    		DL	%f00f9344, %8708a3d2, %1e01f268, %6
042648 68F2011E FEC20669 
042650 5D5762F7 CB676580   A   177    		DL	%f762575d, %806567cb, %196c3671, %6
042658 71366C19 E7066B6E 
042660 761BD4FE E02BD389   A   178    		DL	%fed41b76, %89d32be0, %10da7a5a, %6
042668 5A7ADA10 CC4ADD67 
042670 6FDFB9F9 F9EFBE8E   A   179    		DL	%f9b9df6f, %8ebeeff9, %17b7be43, %6
042678 43BEB717 D58EB060 
042680 E8A3D6D6 7E93D1A1   A   180    		DL	%d6d6a3e8, %a1d1937e, %38d8c2c4, %4
042688 C4C2D838 52F2DF4F 
042690 F167BBD1 6757BCA6   A   181    		DL	%d1bb67f1, %a6bc5767, %3fb506dd, %4
042698 DD06B53F 4B36B248 
0426A0 DA2B0DD8 4C1B0AAF   A   182    		DL	%d80d2bda, %af0a1b4c, %36034af6, %4
0426A8 F64A0336 607A0441 
0426B0 C3EF60DF 55DF67A8   A   183    		DL	%df60efc3, %a867df55, %316e8eef, %4
0426B8 EF8E6E31 79BE6946 
0426C0 8CB361CB 1A8366BC   A   184    		DL	%cb61b38c, %bc66831a, %256fd2a0, %5
0426C8 A0D26F25 36E26852 
0426D0 95770CCC 03470BBB   A   185    		DL	%cc0c7795, %bb0b4703, %220216b9, %5
0426D8 B9160222 2F260555 
0426E0 BE3BBAC5 280BBDB2   A   186    		DL	%c5ba3bbe, %b2bd0b28, %2bb45a92, %5
0426E8 925AB42B 046AB35C 
0426F0 A7FFD7C2 31CFD0B5   A   187    		DL	%c2d7ffa7, %b5d0cf31, %2cd99e8b, %5
0426F8 8B9ED92C 1DAEDE5B 
042700 B0C2649B 26F263EC   A   188    		DL	%9b64c2b0, %ec63f226, %756aa39c, %0
042708 9CA36A75 0A936D02 
042710 A906099C 3F360EEB   A   189    		DL	%9c0906a9, %eb0e363f, %72076785, %0
042718 85670772 13570005 
042720 824ABF95 147AB8E2   A   190    		DL	%95bf4a82, %e2b87a14, %7bb12bae, %0
042728 AE2BB17B 381BB60C 
042730 9B8ED292 0DBED5E5   A   191    		DL	%92d28e9b, %e5d5be0d, %7cdcefb7, %0
042738 B7EFDC7C 21DFDB0B 
042740 D4D2D386 42E2D4F1   A   192    		DL	%86d3d2d4, %f1d4e242, %68ddb3f8, %1
042748 F8B3DD68 6E83DA1F 
042750 CD16BE81 5B26B9F6   A   193    		DL	%81be16cd, %f6b9265b, %6fb077e1, %1
042758 E177B06F 7747B718 
042760 E65A0888 706A0FFF   A   194    		DL	%88085ae6, %ff0f6a70, %66063bca, %1
042768 CA3B0666 5C0B0111 
042770 FF9E658F 69AE62F8   A   195    		DL	%8f659eff, %f862ae69, %616bffd3, %1
042778 D3FF6B61 45CF6C16 
042780 78E20AA0 EED20DD7   A   196    		DL	%a00ae278, %d70dd2ee, %4e048354, %3
042788 5483044E C2B30339 
042790 612667A7 F71660D0   A   197    		DL	%a7672661, %d06016f7, %4969474d, %3
042798 4D476949 DB776E3E 
0427A0 4A6AD1AE DC5AD6D9   A   198    		DL	%aed16a4a, %d9d65adc, %40df0b66, %3
0427A8 660BDF40 F03BD837 
0427B0 53AEBCA9 C59EBBDE   A   199    		DL	%a9bcae53, %debb9ec5, %47b2cf7f, %3
0427B8 7FCFB247 E9FFB530 
0427C0 1CF2BDBD 8AC2BACA   A   200    		DL	%bdbdf21c, %cabac28a, %53b39330, %2
0427C8 3093B353 A6A3B424 
0427D0 0536D0BA 9306D7CD   A   201    		DL	%bad03605, %cdd70693, %54de5729, %2
0427D8 2957DE54 BF67D923 
0427E0 2E7A66B3 B84A61C4   A   202    		DL	%b3667a2e, %c4614ab8, %5d681b02, %2
0427E8 021B685D 942B6F2A 
0427F0 37BE0BB4 A18E0CC3   A   203    		DL	%b40bbe37, %c30c8ea1, %5a05df1b, %2
0427F8 1BDF055A 8DEF022D 
                           A   204    
042800                     A   205    crc32result:
042800                     A   206    	DS 4
                           A   207    
                           A   208    		END


Errors: 0
Warnings: 0
Lines Assembled: 209
